## Личный кабинет вендора 

Для упрощения и автоматизации работы над приложениями магазина приложений был создан **Личный кабинет вендора** (ЛКВ). Это сервис, 
который позволяет вендорам самостоятельно создавать приложения в статусе _Draft_ (_Черновик_), 
отлаживать и тестировать их на витрине приложений, вносить необходимые изменения (в том числе самостоятельно получать и 
изменять SecretKey) и, по окончании разработки, отправлять на модерацию в МойСклад. 

Что можно делать в личном кабинете:
 
- Создавать Черновики приложений; 
- Редактировать Черновики приложений и просматривать информацию о приложениях в прочих статусах;
- Редактировать информацию о разработчике; 
- Отправлять Черновики приложений на модерацию;
- Следить за статусами публикации своих приложений;
- Предоставлять и продлевать пробный период для платных приложений; 
- Привязывать аккаунты в МоемСкладе к аккаунту в Личном кабинете для отладки неопубликованных приложений;
- Просматривать отчеты по установкам и выручке;
- Просматривать, скачивать и согласовывать отчет об использовании приложений;
- Просматривать отчет по причинам удаления приложений. 

#### Получение доступа к личному кабинету Вендора

Для получения доступа в Личный кабинет заполните, пожалуйста, 
<a href="https://partners.moysklad.ru/developers/#register" target="_blank">анкету</a>. 
Мы пришлем вам доступ и дальнейшие инструкции на указанный в анкете email в течение пары дней.

### Жизненный цикл приложения

На текущий момент для приложения магазина приложений предусмотрены следующие статусы жизненного цикла:

* **Черновик** (_Draft_) - статус черновика, предназначен для разработки и тестирования, приложение не отображается на витрине
 у пользователей МоегоСклада.
* **Готово, отправлено на модерацию** (_Ready_) - статус готовности, означает, что приложение со стороны вендора готово к 
публикации (далее приложение будет 
промодерировано сотрудниками МоегоСклада и опубликовано), приложение все еще не отображается на витрине у пользователей 
МоегоСклада.
* **Опубликовано** (_Published_) - приложение опубликовано на витрине приложений и доступно к установке пользователями МоегоСклада.
* **Снято с публикации** (_Hidden_) - публикация приложения приостановлена. Приложение в статусе 
Hidden исчезает с витрины, но при этом у его текущих пользователей сохраняется возможность с ним работать. 

Жизненный цикл приложения выглядит следующим образом:

1. Приложение создается в [Личном кабинете вендора](#lichnyj-kabinet-wendora) со статусом Draft. Вендор проверяет и отлаживает работу 
приложения на аккаунте разработчика. По готовности приложения вендор передает его на публикацию, 
статус приложения меняется на Ready.
2. Сотрудники МоегоСклада проверяют приложение и, в случае отсутствия замечаний, публикуют приложение на витрине,
 статус приложения меняется на Published. Приложение становится доступно для установки пользователями МоегоСклада.
3. Пользователи МоегоСклада подключают/устанавливают приложение на свой аккаунт, выполняют его настройку 
(если таковая опция имеется в приложении), пользуются приложением и, если оно становится ненужным, отключают/удаляют 
приложение с аккаунта. 
4. Если по каким-то причинам приложение требуется убрать с витрины приложений, то оно переводится в статус Hidden.
Установленные до этого момента экземпляры приложений на аккаунтах продолжают работать и отображаться на UI МоегоСклада 
до момента удаления приложения самим пользователем.
Для прочих аккаунтов, а также для аккаунтов, удаливших приложение, оно скрывается и установка становится невозможна.
Подобный вариант скрытия сейчас реализован только для бесплатных приложений.

#### Создание черновика приложения

Форма создания черновика приложения открывается по кнопке **Создать приложение**.  

В первую очередь предлагается заполнить **Псевдоним приложения**. Псевдоним - уникальный идентификатор, поэтому невозможно
создать два приложения с одинаковыми псевдонимами.

В личном кабинете Вендора можно завести следующие **типы приложений**:

 - Серверное приложение
 - Телефонию
 - Приложение лояльности
 
<u>Создание Серверных приложений:</u>
 
При создании Серверного приложения можно указать [платным](#uslowiq-oplaty-prilozhenij) или бесплатным
будет ваше приложение: за это отвечает чекбокс **Платное**.

Для платных приложений нужно определить их стоимость, кратную 500 рублям. Максимальная стоимость приложения, которую можно
задать через ЛКВ, 10000 рублей, минимальная, соответственно, 500 рублей. Если необходимо указать большую стоимость, вендор
может обратиться к сотруднику МоегоСклада.

Для платных приложений открывается возможность добавить [Пробный период](#probnyj-period-platnyh-prilozhenij). 
После установки отметки в чекбоксе **Платное** станет доступен селектор, в котором можно выбрать длительность Пробного периода 
(до 14 дней) или его отсутствие.

При создании Серверного приложения дескриптор обязателен для заполнения. Ознакомиться с правилами его заполнения
можно в разделе [Дескриптор приложения](#deskriptor-prilozheniq).

<u>Создание Телефонии:</u>

При создании приложения с типом Телефония нельзя проставить признак Платности, выбрать Пробный период и не нужно заполнять
Дескриптор. Телефония оплачивается пользователем отдельно - через опцию CRM.

<u>Создание Приложения лояльности:</u>

При создании Приложения лояльности нельзя проставить признак Платности, выбрать Пробный период и не нужно заполнять
Дескриптор.

#### Редактирование черновика приложения

После того, как приложение было создано, может потребоваться что-то в нем изменить.
Для этого необходимо выбрать его в списке приложений и нажать кнопку **Редактировать приложение**.

**Что следует знать:**

- **Редактировать можно только приложения в статусе Черновик**.
    - **После передачи на модерацию** можно будет просматривать данные приложения (нажав на кнопку **Редактировать 
    приложение**), но внести изменения не получится. Возможность редактирования снова появится, если приложение будет 
    возвращено на доработку модератором.
    - **После публикации** приложения изменения могут быть внесены только модератором МоегоСклада по запросу
- **В форме редактирования доступны те же поля, что и в форме создания.** К ним применимо все перечисленное в разделе "Создание черновика приложения" 
- **Доступны просмотр и перегенерация [Секретного ключа](#sekretnyj-kluch-secretkey)**. 
    - Для просмотра следует нажать на кнопку-глаз у скрытого точками поля, для генерации нового ключа - кнопку **Сгенерировать**.
    - кнопка **Сгенерировать**, как и прочие изменения приложения, доступна только для Черновиков
- Также в форме редактирования отображаются read-only поля с техническими параметрами и статусом публикации приложения

#### Отправка на модерацию

Перед публикацией на витрине МоегоСклада новое приложение должно сначала пройти модерацию.

Для отправки на модерацию следует выбрать нужное приложение в статусе Черновик из списка и нажать кнопку **Отправить на модерацию**.

**Важно:** для получения оперативных оповещений о ходе модерации необходимо заполнить **Email для уведомлений** в разделе 
**Вендор**

#### Ручная приостановка приложения 

Возможности Личного кабинета позволяют разработчику тестировать и, при необходимости, отлаживать приложения при приостановке и 
возобновлении на аккаунте.

Для тестирования приостановки необходимо:

1. Привязать аккаунт в МоемСкладе к аккаунту Вендора в ЛКВ (создать аккаунт разработчика).
1. Завести **платное** приложение в ЛКВ.
1. Установить приложение на аккаунте разработчика.
1. Выбрать приложение в списке и нажать кнопку **Приостановить на аккаунте**.
1. Готово! Приложение приостановлено.
1. Для отладки возобновления можно воспользоваться кнопкой **Активировать** в карточке приложения на витрине МоегоСклада.

Приостановка возможна только для приложений, которые уже установлены или устанавливаются. 

#### Продление пробного периода платного приложения

В Личном кабинете доступна возможность единоразово [продлить пробный период](#prodlenie-probnogo-perioda) на выбранном аккаунте для платного опубликованного приложения. 
Для этого необходимо:

1. В Списке приложений выбрать платное опубликованное приложение.
1. Нажать на кнопку **Предоставить пробный период**.
1. В окне **Предоставление пробного периода** заполнить поля **Аккаунт** и **Количество дней**. 
1. При отсутствии ошибок откроется окно **Подтверждение пробного периода**. 
1. Нужно проверить предоставляемый пробный период и нажать на кнопку **Да, предоставить**. 

#### Редактирование информации о вендоре

Для редактирования информации о вендоре (разработчике) приложения потребуется перейти на вкладку **Вендор** в верхнем 
меню Личного кабинета.

Функция доступна, пока на аккаунте отсутствуют приложения или есть только Черновики. В остальных случаях данные доступны 
только для просмотра, а для изменения следует обратиться к модератору МоегоСклада.

Также есть возможность внести или отредактировать реквизиты для выплат денежных средств вендору. 
Для этого потребуется перейти на вкладку **Реквизиты** в верхнем меню.

#### Привязка аккаунта к вендору

Отладка приложений для магазина приложений производится на аккаунтах разработчика. Для того, чтобы аккаунт в МоемСкладе стал 
аккаунтом разработчика, его нужно **привязать к вендору**, и это тоже можно сделать в Личном кабинете вендора.

Инициировать привязку можно по кнопке **Привязать**, расположенной в верхнем меню Личного кабинета.

**Важно:** Для привязки необходимо иметь доступ к email ответственного сотрудника, назначенного в аккаунте МоегоСклада на странице 
Подписка. По умолчанию им является администратор, зарегистрировавший аккаунт, однако впоследствии этого пользователя можно изменить.

Изменить уже существующую привязку можно путем нажатия на имя текущей привязки. Предыдущая привязка будет удалена,
а установленные на отвязанном аккаунте приложения в статусах Черновик (Draft) и Готово,
отправлено на модерацию (Ready) деинсталлированы.

#### Сводный отчет по установкам приложений

В данном отчете можно посмотреть сколько активных установок есть у приложений, сколько из них пробных и оплачиваемых. Также можно посмотреть сколько приостановленных установок.

Для просмотра отчета по установкам необходимо перейти в раздел **Отчеты** в верхнем меню выбрать вкладку **Установки**.

В отчет включаются:

 - Все приложения независимо от платности и наличия установок
 - В статусе Опубликовано и Снято с публикации.

#### Отчет по выручке платных приложений

Данный отчет предоставляет информацию по тому сколько приложение заработало денежных средств. Учитываются только реально оплачиваемые установки. Установки на Пробном тарифе и с Пробным периодом приложений не учитываются.

Для просмотра отчета по выручке необходимо в разделе **Отчеты** верхнего меню выбрать вкладку **Выручка**.

В отчет включаются:

  - Приложения во всех [статусах](#zhiznennyj-cikl-prilozheniq) 
  - Платные приложения, у которых есть хотя бы 1 успешная установка
  - Бесплатные приложения, если ранее они были платными с успешными установками.

#### Отчет об использовании приложений

Отчет об использовании приложений является основанием для выплаты вендору денежных средств за использование приложения пользователями МоегоСклада.

Для просмотра и согласования отчета необходимо в разделе **Отчеты** верхнего меню выбрать вкладку **Выплаты**.

Отчет формируется раз в месяц, доступен для скачивания в виде PDF-файла. Содержит информацию сколько денег заработало каждое приложение в отдельности и все приложения вендора вместе за месяц.

**Что важно знать:** 

1. Для формирования отчета должны быть заполнены реквизиты.
1. Вендору поступает отчет в статусе Сформировано (на почту приходит оповещение).
1. Вендор ознакамливается с отчетом и согласовывает его – кнопка Согласовать.
1. Статус отчета меняется на Согласовано.
1. Выплачивается вознаграждение согласно банковским реквизитам вендора и проставляется отметка Выплачено.

Если вендор имеет возражения по отчету, то он его не согласовывает и обращается к сотруднику МоегоСклада.

#### Отчет по причинам удаления приложений

При удалении приложения на витрине МоегоСклада пользователю предлагается оставить отзыв о приложении:

![useful image](removal-feedback.png)

В случае если пользователь выберет один или несколько пунктов и нажмет на кнопку **Отправить отзыв** на Email для уведомлений вендора, указанный на вкладке [Вендор](#redaktirowanie-informacii-o-wendore),
придет письмо с указанием причины удаления.

Список всех отзывов, оставленных пользователями, отображается в отчете **Причины удаления приложений**. 
Для его просмотра необходимо в разделе **Отчеты** верхнего меню выбрать вкладку **Причины удаления**.

Настроить отправку писем можно с помощью флага "Отправлять уведомления о причинах удаления приложений на email". После отключения уведомления на почту, отзывы продолжат собираться в данный отчет.

На текущий момент есть ограничение: в отчете выводятся только 1000 последних отзывов за выбранный период.

### Отладка приложений на аккаунтах разработчика

Отладка неопубликованных приложений выполняется вендором на специальном аккаунте(ах), привязанных к вендору. 

На таких аккаунтах неопубликованные приложения вендора появляются в специальном блоке на витрине приложений 
"ПРИЛОЖЕНИЯ В РАЗРАБОТКЕ". Для остальных пользователей приложения-черновики не будут видны. 

Неопубликованные приложения можно подключать и отключать так же, как и обычные опубликованные приложения.

Привязка аккаунтов к вендору осуществляется через [Личный кабинет вендора](#lichnyj-kabinet-wendora).  

### Общая схема процесса размещения приложения в магазине приложений

После готовности приложения на стороне вендора в общем случае вендору нужно выполнить следующие шаги по размещению 
приложения в магазине приложений:

1. Создать Черновик приложения в Личном кабинете вендора.
2. После создания Черновика на странице редактирования приложения будет доступен [Секретный ключ](#sekretnyj-kluch-secretkey) (Secret Key).
3. Создать [аккаунт разработчика](#otladka-prilozhenij-na-akkauntah-razrabotchika), привязав [аккаунт 
МоегоСклада](https://online.moysklad.ru/) к аккаунту в [Личном кабинете вендора](#lichnyj-kabinet-wendora).
4. Протестировать и отладить приложение на аккаунте разработчика.
5. Отправить приложение на модерацию через Личный кабинет вендора.

Далее сотрудник МоегоСклада проверяет приложение и, при отсутствии замечаний, публикует его на витрине приложений в течение 2 рабочих дней.

### Права доступа для приложений

Серверные приложения, которые хотят получить доступ к JSON API, в дескрипторе должны указать желаемый уровень доступа к нему.

На текущий момент приложение может запросить следующие уровни доступа:

* **admin** - соответствует пользовательской роли `Системный администратор`: приложение получит полный доступ ко всем отчетам, сущностям и документам в МоемСкладе.
 Этот уровень в перспективе будет устранен.

* **custom** - соответствует пользовательской роли `Индивидуальная роль`: приложение получит доступ только к указанным в дескрипторе отчетам, сущностям и документам.
 Этот уровень **рекомендуется для использования приложениями**, за исключением тех, которые работают с web-хуками и Задачами.
 
На текущий момент права приложения на аккаунте фиксируются на момент установки приложения и при последующем обновлении дескриптора приложения права приложения на данном аккаунте останутся прежними. 

Следует учитывать это при разработке приложений - то есть что одновременно могут существовать и работать установки приложений с разными правами и, 
надо в том или ином поддерживать работу приложения с несколькими наборами прав. 
Предоставление приложению новых дополнительных прав должно происходить через явное подтверждение пользователем и это будет реализовано в будущем. 
Пока что пользователь может обновить права через переустановку: нужно следить, чтобы при удалении приложения данные аккаунта сохранялись какое-то время. 

Подробнее о ролях пользователей см. в [документации JSON API](https://dev.moysklad.ru/doc/api/remap/1.2/dictionaries/#sushhnosti-sotrudnik-rabota-s-pravami-sotrudnika).

Более подробную информацию о правах доступа для приложений можно найти в разделе [Информация о правах доступа](#blok-access).

### Прямая ссылка на приложение

Вендоры могут получить прямую ссылку приложения. 
Для этого нужно в [Личном кабинете вендора](#lichnyj-kabinet-wendora) перейти в режим 
просмотра или редактирования нужного приложения и найти поле 
**Прямая ссылка на приложение**. Прямую ссылку можно также получить с витрины приложений 
из адресной строки браузера, если открыть карточку приложения на витрине.

При переходе по короткой ссылке открывается витрина с карточкой приложения. 
Если пользователь авторизован - то витрина с карточкой открывается сразу, 
если пользователь не авторизован - то через форму логина/авторизацию.

Если приложение не существует или не доступно на аккаунте пользователя, 
использующего прямую ссылку, по какой-либо из причин (то есть, если приложение не отображается 
на витрине, например, приложение в статусе _Draft_), то, при переходе этим пользователем
по ссылке, открывается витрина и появляется сообщение о том, что приложение не найдено.
Если приложение снято с публикации, но уже установлено некоторыми пользователями, 
то у них оно будет отображаться по ссылке, так же, как и на витрине, 
а у остальных, соответственно, нет. 

Так как витрина приложений доступна только администраторам аккаунтов, то карточка приложения
будет доступна только им.

