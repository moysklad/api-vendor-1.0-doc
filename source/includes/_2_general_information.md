## Общая информация

В данном разделе можно узнать:

- какие бывают приложения в Маркетплейсе
- варианты платности приложений
- как создать свое приложение

### Типы приложений в Маркетплейсе

Тип приложения определяет в первую очередь технический способ интеграции приложения с МоимСкладом.

Поддерживаемые на текущий момент типы приложений:

+ Телефония (Phone API)
+ Iframe-приложения
+ Серверные приложения
+ Интеграция с системами лояльности (Loyalty API)

### Сводная таблица поддержки функций для типов приложений

| Тип приложения | Количество приложений на аккаунте | Iframe и доступ к контексту пользователя | Активация и деактивация по Vendor API | Доступ по токену к JSON API 1.2 | Отладка на аккаунтах разработчика | Phone API | Loyalty API | Блок на витрине приложений | Виджеты 
|----|----|----|----|----|----|----|----|----|----|
|Телефония|1| | | |+|+| | Звонки | | 
|Iframe-приложения|Не ограничено|+|  | | + | | |Новые| |   
|Серверные приложения|Не ограничено|+|+|+|+| | |Новые|+|   
|Системы лояльности|1| | | | | |+|Скидки| |   



### Серверные приложения

Серверные приложения - это приложения, основной функционал которых основан на обмене данными с МоимСкладом по JSON API.
 Для этого при активации приложения по Vendor API на сервер вендора передается [токен доступа к JSON API 1.2](#dostup-po-tokenu-k-json-api) 
 (доступ по токену поддерживается только в JSON API 1.2).
 
Для серверных приложений поддерживается активация и деактивация по Vendor API.

Для серверных приложений доступно получение контекста текущего пользователя МоегоСклада (через Vendor API) - 
 то есть можно узнать, какой именно пользователь какого аккаунта открывает приложение в UI МоегоСклада.

Также серверное приложение может иметь свою вкладку среди iframe-приложений и пользовательский интерфейс. Используя 
 данную возможность можно, например, реализовать управление настройками приложения со стороны пользователя 
 МоегоСклада / администратора аккаунта. Поддерживается возможность расширенного iframe-окна (подробнее см. [дескриптор](#blok-iframe)).
 
 Только для серверных приложений доступны [виджеты](#vidzhety).
 
 В общем случае жесткие требования к внешнему виду / визуальному дизайну iframe-части приложений отсутствуют. 
 Тем не менее, приветствуется визуальное соответствие дизайну МоегоСклада. Для этого мы разработали 
 UI Kit (см. скриншот), который доступен по ссылке [https://github.com/moysklad/html-marketplace-1.0-uikit](https://github.com/moysklad/html-marketplace-1.0-uikit).
 
 
 ![useful image](ui-kit.png)
 
Одновременно на аккаунте может быть подключено несколько серверных приложений.

Доступна отладка на аккаунтах разработчика.


### Iframe-приложения

Iframe-приложение представляет собой веб-приложение, которое загружается по указанному вендором URL в iframe на 
отдельной вкладке/странице внутри UI МоегоСклада.

Iframe-приложения просты в разработке и размещении на площадке МоегоСклада, однако такие приложения тоже должны 
соответствовать [требованиям к приложениям](#trebowaniq-k-prilozheniqm).

Для iframe-приложений поддерживается доступ к контексту пользователя и расширение окна iframe, однако **не поддерживается** 
активация и деактивация по Vendor API, а также доступ по токену к JSON API 1.2. 

При построении пользовательского интерфейса в iframe-приложениях также желательно использовать [UI Kit МоегоСклада](https://github.com/moysklad/html-marketplace-1.0-uikit).

Одновременно на аккаунте может быть подключено несколько iframe-приложений.

Доступна отладка на аккаунтах разработчика.


### Телефония

Эти приложения представляют собой интеграцию с внешними сервисами телефонии по Phone API: 
[https://online.moysklad.ru/api/phone/1.0/doc/index.html](https://online.moysklad.ru/api/phone/1.0/doc/index.html)

Приложения телефонии на витрине приложений размещаются в блоке “Звонки”.

На текущий момент возможность получения доступа по токену к JSON API у приложений телефонии отсутствует, как и 
возможность активации и деактивации приложений телефонии по Vendor API (в перспективе такая возможность может 
появиться).

Одновременно на аккаунте может быть подключено только одно приложение телефонии.

Доступна отладка на аккаунтах разработчика.

### Интеграция с системами лояльности

API для интеграции МоегоСклада с системами лояльности и внешними сервисами управления скидками: 
[https://dev.moysklad.ru/doc/api/loyalty/1.0](https://dev.moysklad.ru/doc/api/loyalty/1.0)
 
Эти приложения размещаются на витрине в отдельном блоке “Скидки”. 
Одновременно на аккаунте может быть подключено только одно такое приложение.
 
На текущий момент добавление данного типа приложений через Личный кабинет вендора недоступно.
О том, как опубликовать свою интеграцию, можно прочитать в разделе [Требования к приложениям](#trebowaniq-k-integraciqm-s-sistemami-loql-nosti).

Для отладки можно использовать приложение **Loyalty API** (находится первым в блоке Скидки) совместно с 
приложением Касса МоегоСклада (кроме версии для iOS).

### Платные и бесплатные приложения

На текущий момент в Маркетплейсе поддерживаются как бесплатные, так и платные приложения. 

Бесплатные приложения могут быть установлены пользователями на аккаунте вне зависимости от типа подписки (с 
ограничениями на Бесплатном тарифе) и в любом количестве. Пользователю должен быть доступен весь функционал приложения
без дополнительной оплаты.
Вендор может брать оплату с пользователей приложений самостоятельно, только если для работы приложения требуется свой
сервис для учета транзакций (например: отправка смс, телефония и подобные услуги). Конкретный механизм самостоятельного
взимания оплаты и его реализация остается на усмотрение вендора и не рассматривается в данном документе.

Для платных приложений в системе МойСклад на данный момент доступен любой вариант стоимости, кратный 
500 рублям в месяц. Эта оплата взимается с пользователей в виде платной опции в рамках их подписки на МойСклад — "Опции платных приложений", 
поэтому здесь так же, как на подписку, для пользователей применяются скидки за оплату на 3, 6 и 12 месяцев.

Также мы написали для пользователей подробную инструкцию по тому, как устанавливать и оплачивать приложения. Вы можете 
посмотреть ее [здесь](https://support.moysklad.ru/hc/ru/articles/360039880573-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F). 

Вендор получает 75% от стоимости своих приложений без учета скидок и комиссий. Например, если приложение стоимостью 
500 руб было оплачено на 3 месяца, вендор будет получать  500 * 0,75 = 375 рублей ежемесячно.
 
В дальнейшем возможно изменение доли вендора в ту или иную сторону.

В дальнейшей перспективе будет реализован более гибкий биллинг приложений Маркетплейса, не привязанный в общем случае 
к подписке на МойСклад и в том числе позволяющий устанавливать вендорам произвольную стоимость приложений.

### Пробный период платных приложений

В Маркетплейсе МоегоСклада есть возможность дать пользователям поработать с платным приложением бесплатно некоторое время -
**пробный период**.

**Что важно знать о пробном периоде**: 

+ Пробный период может быть назначен приложению как до публикации, так и после. После публикации пробный период активируется
 только для новых пользователей: им смогут воспользоваться только те, кто еще ни разу не устанавливал приложение.

+ Пробный период можно также изменить или убрать у уже опубликованного приложения. При этом уже установленные экземпляры 
приложений продолжат свою работу с прежним пробным периодом (который был на момент их установки).

+ Длительность пробного периода можно установить от 1 до 14 дней. Когда пробный период завершится, приложение продолжит 
работу платно при наличии "Опций платных приложений" в количестве, требуемом для оплаты приложения.
Если у пользователя не окажется свободных опций — приложение будет приостановлено.

+ Приложения с пробным периодом могут быть установлены на любом тарифе и не зависят от наличия "Опции платных приложений"
 на аккаунте. Однако следует помнить об ограничениях функционала приложений на Бесплатном тарифе (в частности, будут 
 недоступны [вебхуки](#rabota-s-webhukami)).

Приложение с пробным периодом можно создать через [Личный кабинет вендора](#lichnyj-kabinet-wendora).

После публикации добавить, изменить или убрать пробный период вашему приложению может модератор МоегоСклада по запросу. 

### Изменение стоимости приложения

Доступны следующие действия над приложениями:

+ Перевод бесплатного приложение в платное.
+ Перевод платного приложение в бесплатное.
+ Изменение стоимости платного приложения.

Для **неопубликованных** приложений стоимость и признак платности можно изменять через [Личный кабинет вендора](#lichnyj-kabinet-wendora)

Для **опубликованных** приложений Вендору необходимо обратиться к Администратору (модератору) Маркетплейса МоегоСклада.

При переводе опубликованного бесплатного приложения в платное, ему обязательно **назначается пробный период** 
от 7 до 14 дней. Таким образом пользователи, установившие приложение как бесплатное, смогут ещё 
некоторое время продолжить работу с ним бесплатно и принять решение об оплате.

### Жизненный цикл приложения

На текущий момент для приложения Маркетплейса предусмотрены следующие статусы жизненного цикла:

* **Черновик** (_Draft_) - статус черновика, предназначен для разработки и тестирования, приложение не отображается на витрине
 у пользователей МоегоСклада.
* **Готово, отправлено на модерацию** (_Ready_) - статус готовности, означает, что приложение со стороны вендора готово к 
публикации (далее приложение будет 
промодерировано сотрудниками МоегоСклада и опубликовано), приложение все еще не отображается на витрине у пользователей 
МоегоСклада.
* **Опубликовано** (_Published_) - приложение опубликовано на витрине приложений и доступно к установке пользователями МоегоСклада.
* **Снято с публикации** (_Hidden_) - публикация приложения приостановлена. Приложение в статусе 
Hidden исчезает с витрины, но при этом у его текущих пользователей сохраняется возможность с ним работать. 


Жизненный цикл приложения выглядит следующим образом:

1. Приложение создается в [Личном кабинете вендора](#lichnyj-kabinet-wendora) со статусом Draft. Вендор проверяет и отлаживает работу 
приложения на аккаунте разработчика. По готовности приложения вендор передает его на публикацию, 
статус приложения меняется на Ready.
2. Сотрудники МоегоСклада проверяют приложение и, в случае отсутствия замечаний, публикуют приложение на витрине,
 статус приложения меняется на Published. Приложение становится доступно для установки пользователями МоегоСклада.
3. Пользователи МоегоСклада подключают/устанавливают приложение на свой аккаунт, выполняют его настройку 
(если таковая опция имеется в приложении), пользуются приложением и, если оно становится ненужным, отключают/удаляют 
приложение с аккаунта. 
4. Если по каким-то причинам приложение требуется убрать с витрины приложений, то оно переводится в статус Hidden.
Установленные до этого момента экземпляры приложений на аккаунтах продолжают работать и отображаться на UI МоегоСклада 
до момента удаления приложения самим пользователем.
Для прочих аккаунтов, а также для аккаунтов, удаливших приложение, оно скрывается и установка становится невозможна.
Подобный вариант скрытия сейчас реализован только для бесплатных приложений.
