## Общая информация

В данном разделе можно узнать:

- какие бывают приложения в Маркетплейсе
- варианты платности приложений
- как создать свое приложение

### Типы приложений в Маркетплейсе

Тип приложения определяет в первую очередь технический способ интеграции приложения с МоимСкладом.

Поддерживаемые на текущий момент типы приложений:

+ Серверные приложения
+ Телефония (Phone API)
+ Приложения лояльности (Loyalty API)

### Сводная таблица поддержки функций для типов приложений

| Тип приложения | Количество приложений на аккаунте | Iframe и доступ к контексту пользователя | Активация и деактивация по Vendor API | Доступ по токену к JSON API 1.2 | Отладка на аккаунтах разработчика | Phone API | Loyalty API | Виджеты 
|----|----|----|----|----|----|----|----|----|
|Телефония|1| | | |+|+| | |   
|Серверные приложения|Не ограничено|+|+|+|+| | |+|   
|Приложения лояльности|1| | | |+| |+| |   



### Серверные приложения

Серверные приложения - это приложения, основная функциональность которых основана на обмене данными с МоимСкладом по JSON API.
 Для этого при активации приложения по Vendor API на сервер вендора передается [токен доступа к JSON API 1.2](#dostup-po-tokenu-k-json-api) 
 (доступ по токену поддерживается только в JSON API 1.2).
 
Для серверных приложений поддерживается активация и деактивация по Vendor API.

Для серверных приложений доступно получение контекста текущего пользователя МоегоСклада (через Vendor API) - 
 то есть можно узнать, какой именно пользователь какого аккаунта открывает приложение в UI МоегоСклада.

Также серверное приложение может иметь iframe-часть - страницу, которую можно использовать как пользовательский интерфейс, 
в том числе для настроек приложения со стороны пользователя МоегоСклада / администратора аккаунта. 
Iframe-часть приложения загружается по указанному вендором URL на отдельной вкладке внутри раздела Приложения МоегоСклада.
 Поддерживается возможность расширенного iframe (подробнее см. [дескриптор](#blok-iframe)).
 
 Только для серверных приложений доступны [виджеты](#vidzhety).
 
 В общем случае жесткие требования к внешнему виду / визуальному дизайну iframe-части приложений отсутствуют. 
 Тем не менее, приветствуется визуальное соответствие дизайну МоегоСклада. Для этого мы разработали 
 UI Kit (см. скриншот), который доступен по ссылке [https://github.com/moysklad/html-marketplace-1.0-uikit](https://github.com/moysklad/html-marketplace-1.0-uikit).
 
 
 ![useful image](ui-kit.png)
 
Одновременно на аккаунте может быть подключено несколько серверных приложений.

Доступна отладка на аккаунтах разработчика.



### Телефония

Эти приложения представляют собой интеграцию с внешними сервисами телефонии по Phone API: 
[https://online.moysklad.ru/api/phone/1.0/doc/index.html](https://online.moysklad.ru/api/phone/1.0/doc/index.html)

Приложения телефонии на витрине приложений размещаются в блоке “Звонки”.

На текущий момент возможность получения доступа по токену к JSON API у приложений телефонии отсутствует, как и 
возможность активации и деактивации приложений телефонии по Vendor API (в перспективе такая возможность может 
появиться).

Одновременно на аккаунте может быть подключено только одно приложение телефонии.

Доступна отладка на аккаунтах разработчика.

### Приложения лояльности

API для интеграции МоегоСклада с системами лояльности и внешними сервисами управления скидками: 
[https://dev.moysklad.ru/doc/api/loyalty/1.0](https://dev.moysklad.ru/doc/api/loyalty/1.0)
 
Эти приложения размещаются на витрине в отдельном блоке “Скидки”. 
Одновременно на аккаунте может быть подключено только одно такое приложение.
 
Для отладки можно использовать приложение **Loyalty API** (находится первым в блоке Скидки) либо собственный черновик приложения 
совместно с приложением Касса МоегоСклада (кроме версии для iOS).

### Жизненный цикл приложения

На текущий момент для приложения Маркетплейса предусмотрены следующие статусы жизненного цикла:

* **Черновик** (_Draft_) - статус черновика, предназначен для разработки и тестирования, приложение не отображается на витрине
 у пользователей МоегоСклада.
* **Готово, отправлено на модерацию** (_Ready_) - статус готовности, означает, что приложение со стороны вендора готово к 
публикации (далее приложение будет 
промодерировано сотрудниками МоегоСклада и опубликовано), приложение все еще не отображается на витрине у пользователей 
МоегоСклада.
* **Опубликовано** (_Published_) - приложение опубликовано на витрине приложений и доступно к установке пользователями МоегоСклада.
* **Снято с публикации** (_Hidden_) - публикация приложения приостановлена. Приложение в статусе 
Hidden исчезает с витрины, но при этом у его текущих пользователей сохраняется возможность с ним работать. 

Жизненный цикл приложения выглядит следующим образом:

1. Приложение создается в [Личном кабинете вендора](#lichnyj-kabinet-wendora) со статусом Draft. Вендор проверяет и отлаживает работу 
приложения на аккаунте разработчика. По готовности приложения вендор передает его на публикацию, 
статус приложения меняется на Ready.
2. Сотрудники МоегоСклада проверяют приложение и, в случае отсутствия замечаний, публикуют приложение на витрине,
 статус приложения меняется на Published. Приложение становится доступно для установки пользователями МоегоСклада.
3. Пользователи МоегоСклада подключают/устанавливают приложение на свой аккаунт, выполняют его настройку 
(если таковая опция имеется в приложении), пользуются приложением и, если оно становится ненужным, отключают/удаляют 
приложение с аккаунта. 
4. Если по каким-то причинам приложение требуется убрать с витрины приложений, то оно переводится в статус Hidden.
Установленные до этого момента экземпляры приложений на аккаунтах продолжают работать и отображаться на UI МоегоСклада 
до момента удаления приложения самим пользователем.
Для прочих аккаунтов, а также для аккаунтов, удаливших приложение, оно скрывается и установка становится невозможна.
Подобный вариант скрытия сейчас реализован только для бесплатных приложений.

### Прямая ссылка на приложение

Вендоры могут получить прямую ссылку приложения. 
Для этого нужно в [Личном кабинете вендора](#lichnyj-kabinet-wendora) перейти в режим 
просмотра или редактирования нужного приложения и найти поле 
**Прямая ссылка на приложение**. Прямую ссылку можно также получить с витрины приложений 
из адресной строки браузера, если открыть карточку приложения на витрине.

При переходе по короткой ссылке открывается витрина с карточкой приложения. 
Если пользователь авторизован - то витрина с карточкой открывается сразу, 
если пользователь не авторизован - то через форму логина/авторизацию.

Если приложение не существует или не доступно на аккаунте пользователя, 
использующего прямую ссылку, по какой-либо из причин (то есть, если приложение не отображается 
на витрине, например, приложение в статусе _Draft_), то, при переходе этим пользователем
по ссылке, открывается витрина и появляется сообщение о том, что приложение не найдено.
Если приложение снято с публикации, но уже установлено некоторыми пользователями, 
то у них оно будет отображаться по ссылке, так же, как и на витрине, 
а у остальных, соответственно, нет. 

Так как витрина приложений доступна только администраторам аккаунтов, то карточка приложения
будет доступна только им.

### Права доступа для приложений

Серверные приложения, которые хотят получить доступ к JSON API, в дескрипторе должны указать желаемый уровень доступа к нему.

На текущий момент приложение может запросить следующие уровни доступа:

* **admin** - соответствует пользовательской роли `Системный администратор`: приложение получит полный доступ ко всем отчетам, сущностям и документам в МоемСкладе.
 Этот уровень в перспективе будет устранен.

* **custom** - соответствует пользовательской роли `Индивидуальная роль`: приложение получит доступ только к указанным в дескрипторе отчетам, сущностям и документам.
 Этот уровень **рекомендуется для использования приложениями**, за исключением тех, которые работают с web-хуками и Задачами.
 
На текущий момент права приложения на аккаунте фиксируются на момент установки приложения и при последующем обновлении дескриптора приложения права приложения на данном аккаунте останутся прежними. 

Следует учитывать это при разработке приложений - то есть что одновременно могут существовать и работать установки приложений с разными правами и, 
надо в том или ином поддерживать работу приложения с несколькими наборами прав. 
Предоставление приложению новых дополнительных прав должно происходить через явное подтверждение пользователем и это будет реализовано в будущем. 
Пока что пользователь может обновить права через переустановку: нужно следить, чтобы при удалении приложения данные аккаунта сохранялись какое-то время. 

Подробнее о ролях пользователей см. в [документации JSON API](https://dev.moysklad.ru/doc/api/remap/1.2/dictionaries/#sushhnosti-sotrudnik-rabota-s-pravami-sotrudnika).

Более подробную информацию о правах доступа для приложений можно найти в разделе [Информация о правах доступа](#blok-access).

### Условия установки приложений

Количество приложений, которые пользователь может установить на свой аккаунт, зависит от тарифа: 

* Бесплатный пробный тариф — 5 опций платных приложений бесплатно, опции можно докупать. 
* Платный тариф «Старт» — нельзя купить опции платных приложений.
* Остальные платные тарифы — можно купить неограниченное количество опций.

### Условия размещения приложений

* Функциональность приложения доступна пользователю по подписке в полной мере. **Исключение**: СМС, телефония и другие услуги.
* Оплата приложения обычно взимается через биллинг МоегоСклада. В исключительных случаях возможно получения оплаты вендором. Конкретный механизм и его реализация зависит от вендора и согласуется индивидуально. **Исключение**: приложения с собственным биллингом, интеграции со службами телефонии и СМС-рассылок, использующими собственный транзакционный биллинг. 
* Приложения и интеграции, использующие биллинг МоегоСклада, доступны только по платной подписке. Оплата взимается в рамках подписки на МойСклад. Подробнее см. [Условия оплаты](#uslowiq-oplaty-prilozhenij).
* Разместить приложение с платной подпиской может только индивидуальный предприниматель (ИП) или общество с ограниченной ответственностью (ООО), которые являются налоговыми резидентами Российской Федерации.
* Размещая приложение с платной подпиской, разработчик/вендор принимает условия [договора-оферты для разработчиков](https://www.moysklad.ru/upload/files/marketplace.pdf). 

### Условия оплаты приложений

* Для приложений с платной подпиской можно установить ежемесячную оплату, кратную 500 рублям. Например, 500, 1000 или 2500 рублей. 
* Оплата за подписку на приложение взимается с пользователей в рамках стоимости их подписки на МойСклад в категории «Опции платных приложений». 
* На оплату подписки приложения распространяются условия скидок, которые действуют на подписку МоегоСклада. Пользователь получает скидку при единовременной оплате подписки на три, шесть или двенадцать месяцев. 
* Вендор получает 75% от стоимости подписки своего приложения без учета скидок и комиссий. Например, если пользователь оплатил подписку на приложение стоимостью 500 рублей на три месяца, вендор получает 500 * 0,75 = 375 рублей в месяц.
* Если пользователь не продлил или не оплатил подписку, его доступ к приложению приостанавливается, а при поступлении оплаты возобновляется. Подробнее см. [Процесс деактивации приложения на аккаунте](#process-deaktiwacii-prilozheniq-na-akkaunte). 
* В будущем возможно увеличение или уменьшение доли вендора.

### Пробный период платных приложений

Для приложения с платной подпиской можно установить пробный период, чтобы пользователь мог некоторое время поработать с приложением бесплатно и оценить его.

Условия пробного периода:

* Пробный период можно установить до и после публикации приложения. После публикации пробный период выдается только новым пользователям — тем, кто еще ни разу не устанавливал приложение. 
* Пробный период можно изменить или убрать у уже опубликованного приложения. При этом уже установленные экземпляры приложения продолжат свою работу с тем пробным периодом, который был доступен пользователям на момент установки приложения.
* Пробный период длится от одного до четырнадцати дней. После его завершения приложение становится доступно только по подписке и продолжает работу при наличии оплаты. Оплата производится с помощью «Опций платных приложений». При отсутствии у пользователя «Опций платных приложений» в количестве, необходимом для оплаты, доступ к приложению приостанавливается пока пользователь не внесет оплату.
* Приложение с пробным периодом может установить пользователь с любым тарифом независимо от количества «Опций платных приложений» на аккаунте. **Исключение**: пользователям с Бесплатным тарифом недоступны некоторые возможности приложений, например вебхуки.

Чтобы установить пробный период платного приложения до его опубликования,  перейдите в [личный кабинет вендора](https://lk.moysklad.ru/vendor/reports/usage) и укажите количество дней в форме создания приложения.

Чтобы добавить, изменить или удалить пробный период приложения после публикации, обратитесь к модератору МоегоСклада по адресу <apps@moysklad.ru>.

### Продление пробного периода

Пробный период можно продлить только для опубликованного приложения, доступного по платной подписке. Один раз для одного аккаунта МоегоСклада.

Пробный период можно предоставить отдельным пользователям (аккаунтам), если приложение доступно по платной подписке и не имеет пробного периода.

Пробный период запускается по нажатию на кнопку подтверждения. Он длится строго указанное количество дней, но не более четырнадцати. Предоставленный для продления пробный период не суммируется с количеством дней текущего пробного периода и может на него накладываться. То есть если вы установили пробный период на четырнадцать дней, а на десятый день продлили его еще на семь дней, оставшийся пробный период составит семь дней, а не одиннадцать. 

Чтобы продлить пробный период приложения, перейдите в [личный кабинет вендора](https://lk.moysklad.ru/vendor/reports/usage), выберите приложение в Списке приложений и нажмите на кнопку **Продлить пробный период**. 

Пробный период нельзя предоставить, если:

* Приложение не опубликовано.
* Приложение доступно для всех пользователей без подписки и иных ограничений.
* На аккаунте для приложения действует активный пробный период и новый срок сокращает его: уменьшать количество дней нельзя.
* На аккаунте для приложения действует активная оплаченная подписка.
* На аккаунте для приложения уже продлевали пробный период.

### Изменение стоимости приложения

Доступны следующие изменения стоимости приложения:

* Назначение платной подпиской для приложения.
* Снятие ограничений (подписки) для доступа к приложению.
* Изменение стоимости платной подписки для приложения.

Если приложение не опубликовано, перейдите в [личный кабинет вендора](https://lk.moysklad.ru/vendor/reports/usage), чтобы назначить, изменить или отменить стоимость подписки. Если приложение опубликовано, обратитесь к модератору МоегоСклада по адресу <apps@moysklad.ru>.

Если для опубликованного приложения устанавливается платная подписка, обязательно нужно назначить пробный период сроком от семи до четырнадцати дней. Так пользователи, установившие приложение без подписки, смогут еще некоторое время поработать с ним бесплатно и принять решение о покупке подписки.

### Порядок получения выплат

В начале каждого месяца в [личном кабинете вендора](https://lk.moysklad.ru/vendor/reports/usage) формируется отчет за прошедший месяц. В отчете указаны все проданные подписки для всех приложений, их количество и итоговая сумма к выплате.

Чтобы получить выплату:

1. Заполните [реквизиты](https://lk.moysklad.ru/vendor/bankdetails).
1. Проверьте и согласуйте отчет в кабинете вендора. Для этого перейдите в раздел **Отчеты → Выплаты**, выберите период и нажмите на кнопку **Согласовать** в соответствующей строке. 
 ![useful image](approve-button.png)
1. Выплата поступит на указанные реквизиты вендора в течение пяти рабочих дней с даты согласования отчета.

По вопросам, связанным с выплатами, обращайтесь по адресу <apps@moysklad.ru>.